systemMode Startup
systemMode Active

/* Active Mission Test: Automated Startup Sequence
   This script is designed to trigger a chain reaction across all nodes.
*/

node controller CommandCenter : GroundControl
  topic heartbeat = "sys/hb" : int
  topic system_ready = "sys/ready" : bool

  onRequest activate() -> bool
    log info "Activating System Phase: Startup"
    transition system "Startup"
    return true

  onRequest goLive() -> bool
    log warn "System GO LIVE"
    transition system "Active"
    return true

node SensorArray : DataCollector
  topic reading = "sense/val" : float
  
  onListen CommandCenter.system_ready do beginSampling()

  func beginSampling(ready: bool) -> bool
    log "Sensors online. Starting sampling..."
    reading.publish(42.0)
    return true

node LoggerNode : DataRecorder ignore system
  topic disk_status = "disk/stat" : string

  onListen SensorArray.reading do recordData()

  func recordData(val: float) -> bool
    print "DISK RECORD: {val}"
    return true

// --- Startup Sequence Logic ---

mode CommandCenter->Init
  log "Initializing CommandCenter..."
  // This kicks off the whole app
  request CommandCenter.activate()

mode CommandCenter->Startup
  log "CommandCenter in Startup. Signaling sensors..."
  system_ready.publish(true)
  request CommandCenter.goLive()

mode SensorArray->Active
  log error "This is a test"
  log warn "This is a test"
  log info "This is a test"
  log debug "This is a test"
  log "SensorArray detected Active system state."
  print "Sampling at high frequency..."

mode LoggerNode->Init
  disk_status.publish("READY")